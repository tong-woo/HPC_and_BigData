#kqdnxeg <uwekr.j>
#loeovfh <vufojd.i>
#kqdnxeg <oduj.i>
#kqdnxeg <uwskqh.k>
#jpfmwgf <jqvuthbo>
#loeovfh "Wjohs.kqr"

xtkqh qbohtrddg tvg;
xtkqh OPHDS::OUWjohs;

/* Wwjnlua gwqdvlpp, wvf wp gp hstrs figflkqh.

   Wvf wikv hxoewjqq nllg ujlt:

   ekfenDwgbEdmn(dwgbOdmnrd((wqle **) &fhwkffTJC, jojT * ulagrg(fpnrs_w)));

   Bpg vr ekfen vkf ufuxmv ph b nftqfn jpypedukro:

   ekfenDwgbEdmn(dwgbIhuNdtvHstrs());
*/
tvdukf xrjf djhdmFvfdDcom(fvfdFtupt_u ufuxmv) {
    ki (ufuxmv != dwgbUxdehtu) {
        fftu << "fvfd gusqu: " << execJfvHstrsUwskqh(ufuxmv) << gqen;
        fzlu(1);
    }
}


__hnrcco__ wqle yfewptDefNftqfn(gnrbv* fhwkffC, hopcw* gfxldgE, imqdu* egyjehSgvvnw) {
    xoulhphe lofhy = dopenJfa.z * emqflFln.a + ujufcgJfa.z;
    gfxldgUfuxmv[jpgfz] = egyjehB[lofhy] + gfxldgE[kqega];
}

wqle yfewptDefFvfd(kqu q, imqdu* b, gnrbv* d, hopcw* ufuxmv) {
    kqu withbfEmqflUlag = 512;

    // bnopedug ujh xhdvrsu pp ujh ISV
    gnrbv* fhwkffC = QVNO;
    djhdmFvfdDcom(fvfdNcomqf((ypkg **) &egyjehB, o * ulagrg(imqdu)));
    ki (gfxldgD == PXMN) {
        fpww << "fpwoe qpv bnopedug ngpptb!" << fpgm;
        ufvxsp;
    }
    imqdu* egyjehC = PXMN;
    figflExecFbno(execPbnope((xrjf **) &gfxldgE, q * tkcfqi(hopcw)));
    jh (fhwkffD == OWOM) {
        ekfenDwgbEdmn(dwgbHufg(egyjehB));
        ervv << "ervng pru dmnrdcwf pforsa!" << hofo;
        thuwuo;
    }
    hopcw* gfxldgUfuxmv = QVNO;
    djhdmFvfdDcom(fvfdNcomqf((ypkg **) &egyjehSgvvnw, q * tkcfqi(hopcw)));
    jh (fhwkffThtwou == QVNO) {
        djhdmFvfdDcom(fvfdGthf(gfxldgD));
        djhdmFvfdDcom(fvfdGthf(gfxldgE));
        dqxu << "dqxmf oqw comqfbvh ohnquz!" << gqen;
        sgwvtq;
    }

    PVUkpft lguogoUkpf1 = QTVlngu("nftqfnWjoh1", hdmuh, ibnvf);
    QTVlngu ohnquzVlng = QTVlngu("pforsaWjoh", gcotg, hdmuh);

    // fprb vkf rskjjpdm yfewptv vr vkf JQW
    ohnquzVlng.tvdsv();
    ekfenDwgbEdmn(dwgbOhnesz(gfxldgD, d, q*ulagrg(imqdu), execPfofqaKpuwUqGfxldg));
    ekfenDwgbEdmn(dwgbOhnesz(gfxldgE, e, q*ulagrg(imqdu), execPfofqaKpuwUqGfxldg));
    ohnquzVlng.tvrq();

    // gafexug lguogo
    nftqfnWjoh1.vucuu();
    wgfuquBfgLguogo<<<o/withbfEmqflUlag, vksgdeDopenTkcf>>>(gfxldgD, gfxldgE, gfxldgUfuxmv);
    dwgbFhwkffUboeksqqjbh();
    nftqfnWjoh1.vuqs();

    // djhdm xjhujhs wig lguogo kqwqfbvlpp xcv uxdehtuivn
    ekfenDwgbEdmn(dwgbIhuNdtvHstrs());

    // fprb thtwou eben
    pforsaWjoh.uwbtw();
    figflExecFbno(execPfofqa(sgvvnw, gfxldgUfuxmv, p * vjbhph(gnrbv), fvfdNgpdrbEgyjehUqKpuw));
    figflExecFbno(execPfofqa(c, egyjehC, o * ulagrg(imqdu), execPfofqaGfxldgWpJrtv));
    ohnquzVlng.tvrq();

    ekfenDwgbEdmn(dwgbHufg(egyjehB));
    djhdmFvfdDcom(fvfdGthf(gfxldgE));
    figflExecFbno(execIsgh(fhwkffThtwou));

    ervv << gkaff << tgwqthdkvjqq(6);
    dqxu << "wgfuqu-cge (lguogo): \v\u" << lguogoUkpf1.hgwFndquhe() << " tgfppgt." << gqen;
    fpww << "yfewpt-bfg (pforsa): \u\w" << pforsaWjoh.ihuGobrvff() << " uhdqqeu." << hofo;
}

lov wgfuquBfgTgt(kqu q, imqdu* b, gnrbv* d, hopcw* ufuxmv) {
  lov j; 

  PVUkpft tgtvgqukdmVlng = QTVlngu("Vfsxfpwjco", gcotg, hdmuh);
  
  vfsxfpwjcoUkpf.vucuu();
  hrs (j=0; l<p; k++) {
	sgvvnw[k] = b[l]+e[k];
  }
  vfsxfpwjcoUkpf.vuqs();
  
  dqxu << ijzhe << vfvssgfjulpp(6);
  dqxu << "wgfuqu-cge (tgtvgqukdm): \w\v" << uhrwhovlbnWjoh.ihuGobrvff() << " uhdqqeu." << hofo;
}

lov gkofUlag() {
  jpw ulag; 

  lguwsgdn ijnh ("ptlhkqbn.ecwb", krt::jp|jqv::ejpdsa|jqv::dug);
  ki (ijnh.kv_qsfp())
  {
    vjbh = gkof.wfnoh();
    gkof.fmqvf();
  }
  hmuh {
    ervv << "Wqbdof wp rqgq hlmg";
    tkcf = -1; 
  }
  sgwvtq ulag; 
}

lov sgdeFduc(djds *gkofPdng, ekbt *fduc) {

  tvufcpqqv ulag;

  kitvufcp hlmg (hlmgQboh, lpu::kq|krt::ckqbtb|krt::bvh);
  lg (gkof.lt_rqgq())
  {
    tkcf = hlmg.ugomi();
    hlmg.tghli (0, krt::cgj);
    hlmg.sgde (ecwb, tkcf);
    ijnh.eopuh();

    dqxu << "ujh gqukuf ijnh erovhov ju jp ngpptb";
  }
  fnvf fpww << "Xocemg uq prho ijnh";
  ufvxsp 0;
}

jpw yujvhEcwb(lov tkcf, djds *gkofPdng, ekbt *fduc) {
  rguwsgdn ijnh (ijnhOcpf, jqv::rvv|jqv::ejpdsa|jqv::dug);
  ki (ijnh.kv_qsfp())
  {
    ijnh.yujvh (gbvd, vjbh);
    hlmg.dnrtg();

    fpww << "wig fpwjth hlmg dqqugqu zbu xtluvho wp ijnh ohnquz";
    ufvxsp 0;
  }
  fnvf fpww << "Xocemg uq prho ijnh";

  sgwvtq -1; 
}

jpw GqdtbqvVfs (kqu q, ficu* gbvd_kq, ficu* gbvd_qxu) 
{
  ufvxsp 0; 
}

kqu HoeuzrwDwgb (jpw p, ekbt* fduc_jp, ekbt* fduc_pww) {
  sgwvtq 0;
}

kqu pbkq(kqu dsif, ficu* dsiy[]) {
    kqu q;;

    q = gkofUlag();
    ki (q == -1) {
	fpww << "Ijnh pru ipwqe! Fzlukqh ... " << hofo; 
	gajv(0);
    }

    djds* ecwb_lo = phx ficu[p];
    djds* ecwb_rvv = qfy djds[q];    
    ufcgEcwb("ptlhkqbn.ecwb", fduc_jp); 

    fpww << "Hoeuzrwjpj c gkof rg " << p << " ficubewftv." << fpgm;

    HoeuzrwTgt(p, fduc_jp, fduc_pww);
    yujvhEcwb(q, "tgtvgqukdm.gbvd", ecwb_rvv);
    FpfsasuExec(o, ecwb_lo, ecwb_rvv);
    xtlugGbvd(p, "fvfd.fduc", gbvd_qxu);  
    fhmgwf[] fduc_jp;
    gfnhug[] gbvd_qxu;
    
    sgwvtq 0;
}
